<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no" />
<title>Juego Impostor (Kindle web)</title>
<style>
  :root{
    --bg: #ffffff;
    --fg: #000000;
    --accent: #111111;
    --muted: #666;
    --big: 42px;
    --medium: 28px;
    --small: 18px;
    --pad: 18px;
  }
  html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;}
  .wrap{box-sizing:border-box;padding:24px;display:flex;flex-direction:column;gap:18px;height:100%;}
  header{display:flex;align-items:center;justify-content:space-between;}
  h1{font-size:var(--big);margin:0;line-height:1;}
  .muted{color:var(--muted);font-size:var(--small);}
  .card{border-radius:8px;padding:16px;background:transparent;border:2px solid #000;box-shadow:none;}
  .controls{display:flex;gap:12px;flex-wrap:wrap;}
  .control{
    flex:1 1 120px;
    min-width:120px;
    padding:12px;
    text-align:center;
    border-radius:10px;
    font-size:var(--medium);
    border:2px solid #000;
    user-select:none;
    -webkit-user-select:none;
    background:#fff;
  }
  .big-center{font-size:48px;font-weight:700;text-align:center;margin-top:8px;}
  .word-display{font-size:56px;text-align:center;letter-spacing:1px;padding:26px 10px;}
  .btn{
    display:block;
    width:100%;
    padding:18px;
    border-radius:12px;
    border:2px solid #000;
    background:#fff;
    font-size:28px;
    text-align:center;
    cursor:pointer;
    user-select:none;
  }
  .row{display:flex;gap:12px;}
  label{font-size:18px;display:block;margin-bottom:6px;}
  input[type="number"], input[type="text"]{
    width:100%;
    padding:10px;
    font-size:20px;
    border-radius:8px;
    border:2px solid #000;
    box-sizing:border-box;
    background:#fff;
  }
  footer{margin-top:auto;font-size:14px;color:var(--muted);text-align:center;padding-bottom:8px;}
  /* large tap targets for kindle */
  @media (max-width:800px){
    :root{--big:38px;--medium:24px;--small:16px;--pad:14px;}
    .word-display{font-size:48px;}
  }
</style>
</head>
<body>
<div class="wrap" id="app">
  <header>
    <h1>Juego Impostor</h1>
    <div class="muted" id="state-info">v1 • Alex</div>
  </header>

  <!-- CONFIG -->
  <section id="screen-config" class="card">
    <div style="display:flex;gap:16px;align-items:center;justify-content:space-between;flex-wrap:wrap">
      <div style="flex:1;min-width:180px">
        <label for="players">Jugadores (total)</label>
        <input id="players" type="number" min="3" max="20" value="6" />
      </div>
      <div style="flex:1;min-width:160px">
        <label for="impostors">Impostores</label>
        <input id="impostors" type="number" min="1" max="5" value="1" />
      </div>
      <div style="flex:1;min-width:200px">
        <label for="word">Palabra secreta</label>
        <input id="word" type="text" value="Pizza" />
      </div>
    </div>

    <div style="height:12px"></div>

    <div class="controls">
      <button id="btn-random" class="control">Palabra aleatoria</button>
      <button id="btn-save" class="control">Empezar juego</button>
      <button id="btn-reset" class="control">Reset roles</button>
    </div>

    <div style="height:8px"></div>
    <div class="muted">Consejo: usa el botón central o toca "Revelar" cuando pases el dispositivo al siguiente jugador.</div>
  </section>

  <!-- PLAYER VIEW -->
  <section id="screen-player" class="card" style="display:none;flex-direction:column;justify-content:center;align-items:center;">
    <div class="big-center" id="player-title">Jugador 1</div>
    <div class="word-display" id="word-box"> — </div>

    <div style="width:100%;">
      <button id="btn-reveal" class="btn">Revelar palabra</button>
      <div style="height:10px"></div>
      <button id="btn-next" class="btn" style="background:#000;color:#fff;">Pasarlo al siguiente</button>
    </div>

    <div style="height:8px"></div>
    <div class="muted">También: teclas Enter / Espacio = Revelar, N = Siguiente</div>
  </section>

  <!-- END SCREEN -->
  <section id="screen-end" class="card" style="display:none;text-align:center;">
    <div class="big-center">¡Todos han visto su rol!</div>
    <div style="height:12px"></div>
    <button id="btn-restart" class="btn">Volver a configurar</button>
  </section>

  <footer>
    Diseñado para Kindle (experimental browser) — guarda la página en el servidor local o ábrela desde el navegador del Kindle.
  </footer>
</div>

<script>
/* Juego impostor - single file web app */
(function(){
  const el = id => document.getElementById(id);
  // screens
  const screenConfig = el('screen-config');
  const screenPlayer = el('screen-player');
  const screenEnd = el('screen-end');

  // config inputs
  const inpPlayers = el('players');
  const inpImpostors = el('impostors');
  const inpWord = el('word');

  // buttons
  const btnRandom = el('btn-random');
  const btnSave = el('btn-save');
  const btnReset = el('btn-reset');
  const btnReveal = el('btn-reveal');
  const btnNext = el('btn-next');
  const btnRestart = el('btn-restart');

  const playerTitle = el('player-title');
  const wordBox = el('word-box');

  // state
  let players = parseInt(inpPlayers.value,10);
  let impostors = parseInt(inpImpostors.value,10);
  let secretWord = inpWord.value || '';
  let roles = []; // boolean array: true = impostor
  let current = 0;
  let revealed = false;

  const sampleWords = [
    "Pizza","Gato","Robot","Montaña","Coche","Futbol","Llave","Agua",
    "Teléfono","Chocolate","Árbol","Perro","Sombrero","Casa","Libro",
    "Estrella","Zapato","Ordenador","Playa","Camisa"
  ];

  function show(elm){
    screenConfig.style.display = 'none';
    screenPlayer.style.display = 'none';
    screenEnd.style.display = 'none';
    elm.style.display = ''; // show chosen
    // scroll to top for e-ink devices
    window.scrollTo(0,0);
  }

  function clampConfig(){
    players = Math.max(3, Math.min(20, parseInt(inpPlayers.value || 3,10)));
    inpPlayers.value = players;
    impostors = Math.max(1, Math.min(players-1, parseInt(inpImpostors.value || 1,10)));
    inpImpostors.value = impostors;
    secretWord = (inpWord.value || '').trim() || sampleWords[Math.floor(Math.random()*sampleWords.length)];
    inpWord.value = secretWord;
  }

  function assignRoles(){
    roles = new Array(players).fill(false);
    // choose distinct random indexes for impostors
    const picked = new Set();
    while(picked.size < impostors){
      picked.add(Math.floor(Math.random()*players));
    }
    picked.forEach(i => roles[i] = true);
  }

  function startGame(){
    clampConfig();
    assignRoles();
    current = 0;
    revealed = false;
    updatePlayerView();
    show(screenPlayer);
  }

  function updatePlayerView(){
    playerTitle.textContent = `Jugador ${current+1}`;
    wordBox.textContent = '—';
    revealed = false;
    // make reveal button focusable (for physical enter)
    btnReveal.disabled = false;
    btnNext.disabled = true;
  }

  function revealRole(){
    if (revealed) return;
    revealed = true;
    if (roles[current]){
      wordBox.textContent = 'IMPOSTOR ❌';
    } else {
      wordBox.textContent = secretWord;
    }
    // after reveal, enable next
    btnReveal.disabled = true;
    btnNext.disabled = false;
    // for e-ink: force a small reflow / focus
    btnNext.focus();
  }

  function nextPlayer(){
    if (!revealed) return; // force reveal first
    current++;
    if (current >= players){
      show(screenEnd);
    } else {
      updatePlayerView();
    }
  }

  // UI events
  btnRandom.addEventListener('click', ()=>{
    inpWord.value = sampleWords[Math.floor(Math.random()*sampleWords.length)];
  });
  btnSave.addEventListener('click', ()=>{
    // save config from inputs
    clampConfig();
    secretWord = inpWord.value;
    startGame();
  });
  btnReset.addEventListener('click', ()=>{
    // reset roles only
    clampConfig();
    assignRoles();
    alert('Roles reiniciados (nuevos impostores aleatorios).');
  });

  btnReveal.addEventListener('click', revealRole);
  btnNext.addEventListener('click', nextPlayer);
  btnRestart.addEventListener('click', ()=>{
    show(screenConfig);
    window.scrollTo(0,0);
  });

  // keyboard shortcuts for physical keyboards (Enter/Space reveal, N next)
  document.addEventListener('keydown', function(e){
    // ignore if config inputs focused (so typing word works)
    const tag = (document.activeElement || {}).tagName || '';
    if(tag === 'INPUT' || tag === 'TEXTAREA') {
      // allow Enter in config to start
      if(e.key === 'Enter' && screenConfig.style.display !== 'none') {
        e.preventDefault();
        btnSave.click();
      }
      return;
    }

    if(e.key === 'Enter' || e.key === ' '){
      if(screenPlayer.style.display !== 'none') revealRole();
    } else if(e.key.toLowerCase() === 'n'){
      if(screenPlayer.style.display !== 'none') nextPlayer();
    } else if(e.key === 'Escape'){
      // go back to config quickly
      if(screenPlayer.style.display !== 'none') show(screenConfig);
    }
  });

  // load initial
  show(screenConfig);

  // expose a tiny helper for Kindle users who want to use hardware buttons via "sendKey"
  // (some custom firmware exposes this; safe to ignore)
  window.impostorGame = {
    reveal: revealRole,
    next: nextPlayer,
    start: startGame
  };
})();
</script>
</body>
</html>
